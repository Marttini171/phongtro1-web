<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quản lý phòng trọ</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
  <h1 class="text-2xl font-bold mb-4">Quản lý phòng trọ</h1>

  <!-- Thêm/Sửa phòng -->
  <div class="bg-white p-4 rounded shadow mb-6">
    <h2 class="text-lg font-semibold mb-2">Thêm/Sửa phòng</h2>
    <div class="grid grid-cols-2 gap-2 mb-2">
      <input id="maPhong" class="border p-2" placeholder="Mã phòng" />
      <input id="tienPhong" class="border p-2" placeholder="Tiền phòng" />
      <input id="nuoc" class="border p-2" placeholder="Tiền nước" />
      <input id="giat" class="border p-2" placeholder="Tiền giặt" />
      <input id="dichVu" class="border p-2" placeholder="Tiền dịch vụ" />
      <input id="tuLanh" class="border p-2" placeholder="Tiền tủ lạnh" />
      <input id="khac" class="border p-2" placeholder="Chi phí khác" />
      <input id="xe" class="border p-2" placeholder="Tiền xe" />
      <input id="giaDien" class="border p-2" placeholder="Giá điện (đ/kWh)" />
    </div>
    <button onclick="luuPhong()" class="bg-blue-500 text-white px-4 py-2 rounded">Lưu phòng</button>
  </div>

  <!-- Ghi số điện -->
  <div class="bg-white p-4 rounded shadow mb-6">
    <h2 class="text-lg font-semibold mb-2">Ghi số điện theo tháng</h2>
    <select id="chonPhongGhi" class="border p-2 mb-4 w-full"></select>
    <div id="bangDien" class="grid grid-cols-4 gap-2 text-sm"></div>
    <button onclick="luuDien()" class="mt-4 bg-green-500 text-white px-4 py-2 rounded">Lưu toàn bộ số điện</button>
  </div>

  <!-- In phiếu -->
  <div class="bg-white p-4 rounded shadow mb-6">
    <h2 class="text-lg font-semibold mb-2">In phiếu tiền phòng</h2>
    <select id="chonPhongIn" class="border p-2 mb-2 w-full"></select>
    <input id="thangIn" class="border p-2 mb-2 w-full" placeholder="Nhập tháng (1-12)" />
    <button onclick="inPhieu()" class="bg-purple-500 text-white px-4 py-2 rounded">Tính tiền</button>
    <div id="phieu" class="mt-4 bg-gray-100 p-4 rounded border text-sm"></div>
  </div>

  <script>
    let dsPhong = JSON.parse(localStorage.getItem("phong") || "{}");
    let soDien = JSON.parse(localStorage.getItem("soDien") || "{}");

    function capNhatSelect() {
      const select1 = chonPhongGhi, select2 = chonPhongIn;
      select1.innerHTML = select2.innerHTML = '';
      for (let ma in dsPhong) {
        let opt = `<option value="${ma}">${ma}</option>`;
        select1.innerHTML += opt;
        select2.innerHTML += opt;
      }
      hienBangDien();
    }

    function luuPhong() {
      const ma = maPhong.value.trim();
      dsPhong[ma] = {
        tienPhong: +tienPhong.value,
        nuoc: +nuoc.value,
        giat: +giat.value,
        dichVu: +dichVu.value,
        tuLanh: +tuLanh.value,
        khac: +khac.value,
        xe: +xe.value,
        giaDien: +giaDien.value || 4000,
      };
      localStorage.setItem("phong", JSON.stringify(dsPhong));
      capNhatSelect();
      alert("Đã lưu phòng " + ma);
    }

    function hienBangDien() {
      const ma = chonPhongGhi.value;
      const data = soDien[ma] || {};
      bangDien.innerHTML = '';
      for (let i = 1; i <= 12; i++) {
        let thang = i.toString();
        bangDien.innerHTML += `
          <div class="col-span-2 border p-2 rounded bg-gray-50">
            <strong>Tháng ${thang}</strong>
            <input id="cu-${thang}" class="border p-1 w-full mt-1" placeholder="Điện cũ" value="${data[thang]?.cu || ''}" />
            <input id="moi-${thang}" class="border p-1 w-full mt-1" placeholder="Điện mới" value="${data[thang]?.moi || ''}" />
          </div>
        `;
      }
    }

    function luuDien() {
      const ma = chonPhongGhi.value;
      soDien[ma] = {};
      for (let i = 1; i <= 12; i++) {
        const cu = +document.getElementById(`cu-${i}`).value;
        const moi = +document.getElementById(`moi-${i}`).value;
        if (!isNaN(cu) && !isNaN(moi)) {
          soDien[ma][i] = { cu, moi };
        }
      }
      localStorage.setItem("soDien", JSON.stringify(soDien));
      alert("Đã lưu số điện cho phòng " + ma);
    }

    function inPhieu() {
      const ma = chonPhongIn.value;
      const thang = thangIn.value.trim();
      const phong = dsPhong[ma];
      const dien = soDien[ma]?.[thang];
      if (!phong || !dien) return phieu.innerHTML = "Thiếu dữ liệu phòng hoặc số điện.";

      const sd = dien.moi - dien.cu;
      const tienDien = sd * phong.giaDien;
      const tong = phong.tienPhong + phong.nuoc + phong.giat + phong.dichVu + phong.tuLanh + phong.khac + phong.xe + tienDien;

      phieu.innerHTML = `
        <p><strong>Phòng:</strong> ${ma}</p>
        <p><strong>Tháng:</strong> ${thang}</p>
        <p>Điện cũ: ${dien.cu} | mới: ${dien.moi} → dùng: ${sd} kWh</p>
        <p>Giá điện: ${phong.giaDien.toLocaleString()} đ</p>
        <p>Tiền điện: ${tienDien.toLocaleString()} đ</p>
        <hr class="my-2" />
        <p>Tiền phòng: ${phong.tienPhong.toLocaleString()} đ</p>
        <p>Nước: ${phong.nuoc.toLocaleString()} đ</p>
        <p>Giặt: ${phong.giat.toLocaleString()} đ</p>
        <p>Dịch vụ: ${phong.dichVu.toLocaleString()} đ</p>
        <p>Tủ lạnh: ${phong.tuLanh.toLocaleString()} đ</p>
        <p>Khác: ${phong.khac.toLocaleString()} đ</p>
        <p>Tiền xe: ${phong.xe.toLocaleString()} đ</p>
        <hr class="my-2" />
        <p><strong>Tổng cộng: ${tong.toLocaleString()} đ</strong></p>
      `;
    }

    capNhatSelect();
  </script>
</body>
</html>
